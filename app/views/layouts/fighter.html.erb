<% page_title @fighter.name %>

<% content_for :nav_search do %>
  <%= render "searches/search_form" %>
<% end %>

<% content_for :main do %>
  <% unless @fighter.synchronized? %>
    <%= turbo_stream_from Current.session, @fighter.id, :synchronization %>
    <%= synchronization_request_form @fighter, data: { turbo_frame: "fighter_synchronization" } %>
  <% end %>

  <%= turbo_frame_tag "fighter-content", data: { turbo_action: "advance" } do %>
    <div id="fighter-header">
      <%= turbo_frame_tag "fighter_synchronization" %>
      <h1><%= @fighter.name %></h1>

      <% @fighter.synchronized_at.try do |synchronized_at| %>
        <small>
          <%= t(".synchronized_at_html", local_time_ago: local_time_ago(synchronized_at)) %>
        </small>
      <% end %>
    </div>

    <nav class="py-3">
      <ul class="nav nav-fill nav-underline">
        <%= fighter_header_nav_item Match.model_name.human, :fighter_matches, params: request.query_parameters.to_h %>
        <%= fighter_header_nav_item MatchupChart.model_name.human, :fighter_matchup_chart, params: request.query_parameters.to_h %>
        <%= fighter_header_nav_item RankedHistory.model_name.human, :fighter_ranked_history, params: request.query_parameters.to_h %>
      </ul>
    </nav>

    <%= yield %>
  <% end %>
<% end %>

<%= render template: "layouts/application" %>
